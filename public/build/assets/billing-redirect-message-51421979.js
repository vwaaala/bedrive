import{bt as z,co as B,r as o,cb as F,u as V,b as R,j as a,c as W,B as T,E as c,A as q,n as _,z as k,bQ as G,T as N,_ as U}from"./main-121e419e.js";import{T as X}from"./TaskAlt-4cb6f941.js";var A="https://js.stripe.com/v3",O=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,P="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",Q=function(){for(var e=document.querySelectorAll('script[src^="'.concat(A,'"]')),t=0;t<e.length;t++){var n=e[t];if(O.test(n.src))return n}return null},I=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(A).concat(t);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(n),n},H=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"2.4.0",startTime:t})},S=null,E=null,w=null,J=function(e){return function(){e(new Error("Failed to load Stripe.js"))}},K=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},Y=function(e){return S!==null?S:(S=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(P),window.Stripe){t(window.Stripe);return}try{var s=Q();if(s&&e)console.warn(P);else if(!s)s=I(e);else if(s&&w!==null&&E!==null){var i;s.removeEventListener("load",w),s.removeEventListener("error",E),(i=s.parentNode)===null||i===void 0||i.removeChild(s),s=I(e)}w=K(t,n),E=J(n),s.addEventListener("load",w),s.addEventListener("error",E)}catch(l){n(l);return}}),S.catch(function(t){return S=null,Promise.reject(t)}))},Z=function(e,t,n){if(e===null)return null;var s=e.apply(void 0,t);return H(s,n),s},x,C=!1,D=function(){return x||(x=Y(null).catch(function(e){return x=null,Promise.reject(e)}),x)};Promise.resolve().then(function(){return D()}).catch(function(r){C||console.warn(r)});var $=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];C=!0;var s=Date.now();return D().then(function(i){return Z(i,t,s)})};function ee({type:r,productId:e,priceId:t}){const{user:n}=z(),s=B(),i=o.useRef(!1),l=o.useRef(null),{localeCode:h}=F(),[d,b]=o.useState(null),[y,j]=o.useState(null),{branding:{site_name:m},billing:{stripe_public_key:u,stripe:{enable:p}}}=V();return o.useEffect(()=>{!p||!u||i.current||(Promise.all([$(u,{apiVersion:"2022-08-01",locale:h}),r==="setupIntent"?te():ne(e,t)]).then(([f,{clientSecret:g}])=>{if(f&&l.current){const v=f.elements({clientSecret:g,appearance:{theme:s?"night":"stripe"}});v.create("payment",{business:{name:m},terms:{card:"never"},fields:{billingDetails:{address:"auto"}},defaultValues:{billingDetails:{email:n==null?void 0:n.email}}}).mount(l.current),b(f),j(v)}}),i.current=!0)},[e,u,p,s,h,m,r,n==null?void 0:n.email]),{stripe:d,elements:y,paymentElementRef:l,stripeIsEnabled:u!=null&&p}}function te(){return R.post("billing/stripe/create-setup-intent").then(r=>r.data)}function ne(r,e){return R.post("billing/stripe/create-partial-subscription",{product_id:r,price_id:e}).then(t=>t.data)}function le({productId:r,priceId:e,type:t="subscription",submitLabel:n,returnUrl:s}){const{stripe:i,elements:l,paymentElementRef:h,stripeIsEnabled:d}=ee({type:t,productId:r,priceId:e}),[b,y]=o.useState(null),[j,m]=o.useState(!1),u=!d||l!=null&&i!=null,p=async f=>{var g,v;if(f.preventDefault(),!(!i||!l)){m(!0);try{const L=await i[t==="subscription"?"confirmPayment":"confirmSetup"]({elements:l,confirmParams:{return_url:s}});((g=L.error)==null?void 0:g.type)!=="validation_error"&&((v=L.error)!=null&&v.message)&&y(L.error.message)}catch{}m(!1)}};return a.jsxs("form",{onSubmit:p,children:[a.jsx("div",{ref:h,className:W("min-h-[303px]",!d&&"hidden"),children:d&&a.jsx(re,{})}),b&&!j&&a.jsx("div",{className:"mt-20 text-danger",children:b}),a.jsx(T,{variant:"flat",color:"primary",size:"md",className:"mt-40 w-full",type:"submit",disabled:j||!u,children:n})]})}function re(){return a.jsxs(o.Fragment,{children:[a.jsx(c,{className:"mb-20 h-30"}),a.jsx(c,{className:"mb-20 h-30"}),a.jsx(c,{className:"mb-20 h-30"}),a.jsx(c,{className:"h-30"})]})}function oe({config:r}){return a.jsx(q,{initial:!1,mode:"wait",children:a.jsx("div",{className:"mt-80",children:r?a.jsxs(_.div,{className:"text-center",...k,children:[r.status==="success"?a.jsx(X,{className:"text-positive text-6xl"}):a.jsx(G,{className:"text-danger text-6xl"}),a.jsx("div",{className:"text-2xl font-semibold mt-30",children:a.jsx(N,{...r.message})}),a.jsx(T,{variant:"flat",color:"primary",className:"w-full mt-30",size:"md",elementType:U,to:r.link,children:a.jsx(N,{...r.buttonLabel})})]},"payment-status"):a.jsx(se,{},"loading-skeleton")})})}function se(){return a.jsxs(_.div,{className:"text-center max-w-280",...k,children:[a.jsx(c,{size:"w-50 h-50",variant:"rect"}),a.jsx(c,{className:"text-2xl mt-30"}),a.jsx(c,{size:"h-42",className:"mt-30"})]},"loading-skeleton")}export{oe as B,le as S,$ as l};
//# sourceMappingURL=billing-redirect-message-51421979.js.map
